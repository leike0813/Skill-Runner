## 1. 命令与会话模型重构

- [x] 1.1 将 `UiShellManager` 白名单收敛为每引擎一个 TUI 命令（codex/gemini/iflow）
- [x] 1.2 移除 login/auth/version/interactive 模式分支与相关字段
- [x] 1.3 保留并验证单活跃会话互斥与 Stop 终止行为
- [x] 1.4 引入每会话隔离目录 `data/ui_shell_sessions/<session_id>`，并收敛会话 `cwd`

## 2. 终端渲染与传输改造

- [x] 2.1 在 UI 层引入 xterm.js 终端仿真
- [x] 2.2 新增 WebSocket 双向通道（输出流 + 键盘输入）
- [x] 2.3 保证 UTF-8 + ANSI/VT 序列在前端可正确显示
- [x] 2.4 启动按钮采用“点击后即时反馈”策略（不预禁用）
- [x] 2.5 将 xterm 依赖改为本地静态资源（不依赖 CDN）

## 3. 沙箱与防逃逸

- [x] 3.1 为每个引擎实现 sandbox 启动参数/配置注入路径
- [x] 3.2 增加 sandbox 可用性探测，失败即 fail-closed 拒绝启动
- [x] 3.3 明确会话可写范围仅 `session_dir` + `agent_home`

## 4. 页面与路由重构

- [x] 4.1 在 `/ui/engines` 集成内嵌终端区域与引擎级启动按钮
- [x] 4.2 下线 `/ui/engines/auth-shell` 独立页面路由（404）
- [x] 4.3 保持现有引擎管理表格、升级与模型管理能力不回退
- [x] 4.4 挂载 UI 静态资源路径并确保镜像构建包含该目录

## 5. 测试与回归

- [x] 5.1 更新/新增服务层单元测试（命令映射、互斥、停止、超时）
- [x] 5.2 新增 sandbox fail-closed 与写边界测试
- [x] 5.3 更新/新增路由测试（新入口、旧路由下线、鉴权）
- [x] 5.4 运行相关测试与类型检查
- [x] 5.5 新增静态资源路径与模板引用校验（避免回退到 CDN）

## 6. 文档更新

- [x] 6.1 更新 README（中/英）：说明引擎页内嵌终端与使用方式
- [x] 6.2 更新 API/UI 文档：移除旧页面，补充新交互说明
- [x] 6.3 增加安全说明：sandbox 不可用时拒绝启动，不会降级裸跑
