## 背景

`skill-converter-agent` 已具备“提示词优先 + 最终脚本校验”的基础能力，但入口抽象仍不够清晰。  
本次重构将执行语义明确为：

- **主语义**：目录原地改造（适配交互式 Agent 使用）
- **包装语义**：zip 解包/打包（仅适配 Skill-Runner 自动执行）

核心原则：**转换逻辑只有一套，包装流程不引入第二套转换逻辑**。

## 目标与非目标

### 目标

- 统一转换主流程为目录模式。
- 在 `SKILL.md` 中完整定义分类、判定、patch 策略与失败分支。
- Skill-Runner 路径通过“解包 -> 调同一目录流程 -> 打包”实现复用。
- 保持最终验证门：转换后必须走契约校验。

### 非目标

- 不新增独立的“zip 专用转换算法”。
- 不把核心判断下沉到复杂脚本中替代 LLM 决策。
- 不改动 Skill-Runner 其它业务 API。

## 架构决策

### 决策 1：目录优先单一主流程

方案：

1. 输入一个目标目录（用户指定的 skill 根目录）。
2. Agent 按 `SKILL.md` 指令完成：
   - 解析原始内容
   - 分类任务类型
   - 评估可转换性
   - patch `SKILL.md`
   - 生成 `input/parameter/output schema + runner.json`
3. 执行最终验证脚本。

理由：

- 交互式场景最自然。
- 可观察、可中断、可人工确认边界条件。
- 与“Agent Skill 以指令驱动”为一致模型。

### 决策 2：zip 仅包装，不新增转换分支

方案：

1. wrapper 脚本解压 zip 到固定工作目录。
2. 调用与目录模式相同的转换流程。
3. 打包目录为输出 artifact。

理由：

- 降低逻辑分叉风险。
- 便于测试与维护，避免“目录成功、zip 失败”的双实现漂移。

### 决策 3：可转换性判定标准显式化（写入 SKILL.md）

分类固定三类：

- `not_convertible`
- `convertible_with_constraints`
- `ready_for_auto`

判定依据（至少覆盖）：

- 是否高度依赖实时用户决策
- 输入输出能否稳定结构化
- 关键步骤是否可重复、可验证
- 失败路径是否可控并可给出明确原因

其中 `not_convertible` 必须立即停止，仅返回失败原因。

### 决策 4：Patch 策略模板化

在 `SKILL.md` 中提供模板化提示：

- 对“直接返回结果型”任务如何补输出 schema
- 对“产出文件型”任务如何定义 artifact
- 对“修改文件型”任务如何声明输入/参数与结果检查点

并给出简短示例片段，减少 Agent 生成漂移。

## 风险与对策

- 风险：LLM 判断不稳定导致过度转换或误判不可转换。  
  对策：在 `SKILL.md` 写清判定门槛与反例，并强制输出判定依据摘要。

- 风险：zip 包装层污染主流程。  
  对策：明确 wrapper 只做 I/O 搬运，不参与决策。

- 风险：目录原地改造误改。  
  对策：先生成变更计划（文件级），再执行写入；必要时要求交互确认。

## 迁移计划

1. 增补/重写 `SKILL.md` 为中文目录优先流程。
2. 参数与 runner 描述改为“目录主入口 + zip 包装入口”。
3. 增加/整理 wrapper 脚本（仅解包打包）。
4. 补测试：
   - 目录模式
   - zip 包装模式（复用同一逻辑）
   - `not_convertible` 分支

