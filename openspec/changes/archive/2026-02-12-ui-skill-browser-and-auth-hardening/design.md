## 背景

Skill Runner 已具备 skill 清单展示与安装能力，但缺乏单个 skill 的内部可视化检查。  
同时，UI Basic Auth 已实现，但需要明确“如何观测是否生效”并补齐边界场景测试。

## 目标

1. 新增 skill 包结构浏览页面（只读）
2. 新增文件内容浏览能力（只读）
3. 明确并落地文件浏览安全策略
4. 强化 Basic Auth 生效可观测性与验证路径

## 路由设计

### 1) Skill 详情页

- `GET /ui/skills/{skill_id}`
  - 展示 skill 基本信息（id、name、description、version、engines）
  - 展示该 skill 根目录树（折叠或平铺）
  - 每个文件提供“查看”入口

### 2) 文件预览接口

- `GET /ui/skills/{skill_id}/view?path=<relative_path>`
  - `path` 必须是 skill 根目录内相对路径
  - 返回文本内容预览页面/partial

## 文件浏览安全策略

### 路径限制（必须）

- 拒绝绝对路径
- 拒绝 `..` 路径穿越
- 解析后路径必须仍位于 `skills/<skill_id>/` 内
- 不跟随可导致目录逃逸的符号链接

### 内容策略

- 仅文本文件可预览内容
- 二进制文件：
  - 显示“不可预览”
  - 元信息显示为“无信息”
- 文本文件大小上限：`256KB`
  - 超限时不返回全文，提示“文件过大不可预览”

## Basic Auth 硬化

### 保护范围（保持不变）

- `/ui/*`
- `/v1/skill-packages/*`

### 可观测性增强

- 启动时输出明确日志：
  - `UI basic auth enabled: true/false`
  - 受保护路由范围
- 当启用鉴权时，缺少用户名或密码继续保持 fail-fast。

## 测试策略

1. UI 浏览测试
   - skill 详情页可加载
   - 文件树展示正确
   - 文本文件可预览
   - 二进制文件显示“不可预览/无信息”
   - 超大文本文件显示“文件过大不可预览”

2. 安全测试
   - `path=../../...` 被拒绝
   - 绝对路径被拒绝
   - 非 skill 内路径被拒绝

3. 鉴权测试
   - 开启鉴权时，未认证访问受保护路由返回 401
   - 正确凭据访问受保护路由返回 200

## 风险与缓解

- 风险：大文件/二进制文件预览引发性能与编码问题  
  缓解：统一大小上限与二进制降级策略。

- 风险：路径校验不严导致目录逃逸  
  缓解：统一实现安全路径解析函数并单测覆盖。
